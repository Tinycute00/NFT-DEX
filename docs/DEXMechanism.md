# NFT DEX 雙池機制及 FLP 模型詳細設計文檔

## 1. 雙池子機制

在本系統中，NFT 的價格保證機制是基於雙池設計，整體的底價池來源於 NFT 本身的稀有度分配，並由兩個部分組成：

- **基礎池**：
  - 來源：鑄造 NFT 時收取的 10% 費用組成。
  - 特性：基礎池資金固定，不受市場交易價格波動影響，作為 NFT 的最低（基礎）價格保證。

- **溢價池**：
  - 組成：由系統溢價池和 FLP 組成，其中系統溢價池收取額外10%費用，這筆資金屬於系統持有，不參與 FLP 分紅；而 FLP 是通過 NFT 質押後鑄造，其信息與質押的 NFT 完全一致，可參與交易手續費收益分配。
  - 初始狀態：初始金額為 0，FLP 數量也從 0 開始累積。

## 2. FLP 機制

- **FLP 的鑄造由用戶操作**：
  - 在 FLP 鑄造時，額外收取(溢價+基礎價格)10%費用， 10% 資金直接轉入系統溢價池。
  - 當用戶對 NFT 進行質押（即 NFT SAKE）後，系統根據質押數量鑄造相應的 FLP 代幣。

- **FLP 的作用**：
  - FLP 作為 NFT 質押後的產物，類似於 AMM 機制中的憑證，但不直接參與市場交易，而是用以支撐 NFT 的底價。
  - FLP 持有者可獲取部分交易手續費收益。
  - 當用戶進行 FLP UNSTAKE 操作時，可獲得在質押期間累積的分配金額，加上相應的基礎價格與溢價收益。

- **未質押 NFT 的處理**：
  - 若 NFT 未參與質押，其相應的溢價部分將直接進入系統溢價池，用於市場價格的動態調整。

## 3. 工作模式：用戶市場與系統市場

系統後端採用兩種不同的價格計算模型來處理交易：

### (a) 用戶市場（User Market）

- **交易價格組成**：
  - NFT 價格 = （基礎價格 + 溢價格） + 用戶溢價
  - 其中，用戶溢價 = 實際交易價格 - （基礎價格 + 溢價）。

- **手續費機制**：
  - 每筆交易收取 3% 手續費：
    - 1% 作為平台手續費收入。
    - 2% 分配進入溢價池，用於後續的價格支持與 FLP 生成。

### (b) 系統市場（System Market）

此市場專門處理用戶與系統之間的交互，交易模型與用戶市場存在差異：

- **賣給系統**：
  - 用戶只能以 NFT 的 (基礎價格 + 溢價) 價格賣出，不允許額外加價。
  - 賣出後，該 NFT 的溢價將會線性降低，並在 90 天後完全歸零。

- **從系統購買**：
  - 購買價格 = 基礎價格 + 動態溢價 + 10% 交易手續費。
  - 其中，動態溢價隨著 NFT 賣出後剩餘時間調整（隨時間下降，90 天後溢價歸零）。
  - 10% 交易手續費的分配：8% 進入溢價池，2% 為平台收入。

## 4. 費用收取與資金流向

- **用戶市場**：
  - 每筆用戶之間的交易，從最終成交價格中扣除 3% 手續費（1% 平台收入，2% 進入溢價池）。

- **系統市場**：
  - 賣給系統時，交易只按照 (基礎價格 + 溢價) 計價；
  - 購買時除了支付 NFT 價格外，還需支付額外 10% 手續費（其中 8% 用於補充溢價池，2% 為平台收入）。
  - 賣出後，NFT 的溢價會隨時間現性降低，在 90 天後降為零。

- **FLP 鑄造與費用**：
  - 鑄造 FLP 時額外收取 10% 費用，這筆費用進入系統溢價池，進一步支持 NFT 的動態價格機制

## 5. 設計意圖與未來優化

- **價格穩定與激勵**：透過雙池設計，保證 NFT 即使在低流動性時也有一個最低價格，同時動態溢價激勵市場交易。
- **分市場模型**：區分用戶市場與系統市場，各自有針對性的交易價格與手續費設計，滿足不同交易場景的需求。
- **時間調整機制**：系統市場中，NFT 的溢價隨時間下降，90 天後歸零，這有助於防止價格過高或長期不平衡。
- **手續費分流**：嚴格劃分交易手續費的分配，確保平台與溢價池均能獲得穩定收入，支撐後續系統運行。

## 5. 稀有度設定

在本系統中，稀有度的設定並不採用統一的標準化方案，而是依照各項目自身的NFT數量和分佈情況進行調節。該策略允許創作者根據具體情況自訂稀有度計算方式，從而與項目初始設定保持一致，確保每個項目都能獨立地反映其NFT的稀有性及價值。 